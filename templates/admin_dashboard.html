{% extends "base.html" %}
{% block content %}
<section class="card">
  <h2>لوحة التحكم</h2>
  <div class="stats">
    <div class="stat">الطلاب: <strong>{{ counts.students }}</strong></div>
    <div class="stat">الرسائل: <strong>{{ counts.messages }}</strong></div>
    <div class="stat">التسليمات: <strong>{{ counts.submissions }}</strong></div>
    <div class="stat">التقييمات: <strong>{{ counts.ratings }}</strong></div>
  </div>
  <div class="actions">
    <a class="btn" href="{{ url_for('admin_users') }}">إدارة المستخدمين</a>
    <a class="btn" href="{{ url_for('admin_export') }}">تصدير الدرجات (CSV)</a>
  </div>
</section>

<section class="card">
  <h3>أحدث التسليمات</h3>
  <table class="table">
    <thead>
      <tr><th>#</th><th>الطالب</th><th>النص</th><th>الدرجة</th><th>إجراء</th></tr>
    </thead>
    <tbody>
      {% for s in recent_subs %}
      <tr>
        <td><a href="{{ url_for('submission_detail', submission_id=s.id) }}">{{ s.id }}</a></td>
        <td>{{ s.username or 'N/A' }}</td>
        <td class="wrap">{{ s.text }}</td>
        <td>{{ s.grade if s.grade is not none else "-" }}</td>
        <td>
            <a href="{{ url_for('submission_detail', submission_id=s.id) }}" class="btn btn-ghost">مراجعة</a>
        </td>
      </tr>
      {% else %}
      <tr><td colspan="5" class="muted">لا توجد تسليمات.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</section>

<section class="card">
  <h3>أحدث التقييمات</h3>
  <table class="table">
    <thead>
      <tr><th>#</th><th>الطالب</th><th>العنصر</th><th>التقييم</th><th>التاريخ</th></tr>
    </thead>
    <tbody>
      {% for r in recent_ratings %}
      <tr>
        <td>{{ r.id }}</td>
        <td>{{ r.username }}</td>
        <td>{{ r.item }}</td>
        <td>{{ r.rating_value if r.get('rating_value') is not none else r.rating }}</td> {# Display new or old rating #}
        <td><time datetime="{{ r.created_at }}">{{ r.created_at }}</time></td>
      </tr>
      {% else %}
      <tr><td colspan="5" class="muted">لا توجد تقييمات.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</section>
{% endblock %}